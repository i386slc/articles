# Docker ARG, ENV и .env — полное руководство

{% hint style="info" %}
Ссылка на оригинальную статью: [Docker ARG, ENV and .env - a Complete Guide](https://vsupalov.com/docker-arg-env-variable-guide/)

Опубликовано:

Автор:
{% endhint %}

Создание образов Docker и настройка докеризированных приложений не обязательно должны быть феерией Google. Эта статья поможет вам уверенно работать с файлами Docker **ARG**, **ENV**, **env\_file** и `.env`.

> Единственное условие: убедитесь, что вы знакомы с [основами Docker](https://vsupalov.com/6-docker-basics/).

Читайте дальше, и вы поймете, как с легкостью настраивать образы Docker и докеризованные приложения — с помощью переменных во время сборки Docker, переменных среды и шаблонов для docker-compose.

## Частые заблуждения

Это долгое, глубокое чтение. Давайте начнем с того, что вы можете использовать прямо сейчас, без необходимости читать все!

Вот список **простых выводов**:

1. **Файл .env** используется только на этапе предварительной обработки при работе с файлами `docker-compose.yml`. Переменные в $-нотации, такие как `$HI`, заменяются значениями, содержащимися в именованном файле «`.env`» в том же каталоге.
2. **ARG** доступен **только во время сборки образа** Docker (**RUN** и т. д.), а не после создания образа и запуска из него контейнеров (**ENTRYPOINT**, **CMD**). Вы можете использовать значения **ARG**, чтобы установить значения **ENV**, чтобы [обойти это](https://vsupalov.com/docker-build-time-env-values/).
3. Значения **ENV** доступны для контейнеров, а также для команд в стиле **RUN** во время сборки Docker, начиная со строки, в которой они представлены.
4. Если вы установите переменную среды в **промежуточном контейнере** с помощью **bash** (`RUN export VARI=5 && …`), она **не сохранится** в следующей команде. Есть способ [обойти это](https://vsupalov.com/set-dynamic-environment-variable-during-docker-image-build/).
5. **env\_file** — это удобный способ передать **множество** переменных среды одной команде в одном пакете. Его не следует путать с файлом `.env`.
6. Установка значений **ARG** и **ENV** оставляет **следы** в образе Docker. Не используйте их для секретов, которые не предназначены для хранения (ну, вы можете использовать [многоэтапные сборки](https://vsupalov.com/build-docker-image-clone-private-repo-ssh-key/)).

## Обзор

Хорошо, давайте начнем с деталей. Руководство разбито на следующие темы:

* [Файл Dot-Env (.env)](docker-arg-env-i-.env-polnoe-rukovodstvo.md#fail-dot-env-.env)
* Доступность ARG и ENV
* Установка значений ARG
* Установка значений ENV
* Переопределение значений ENV

Не стесняйтесь сразу перейти к тому, что вам нужно прямо сейчас. Тем не менее, вы получите наилучший результат, если внимательно прочитаете их все.

## Файл Dot-Env (.env)

Это довольно просто и сбивает с толку только из-за плохих примеров и похожих концепций, использующих тот же формат, что очень похоже на это. Важна точка перед **env** — `.env`, а не «**env\_file**».

Если в вашем проекте есть файл с именем [.env](https://docs.docker.com/compose/environment-variables/#the-env-file), он используется только для помещения значений в файл **docker-compose.yml**, который находится в той же папке. Они используются с **Docker Compose** и **Docker Stack**. Это не имеет никакого отношения к **ENV**, **ARG** или чему-либо специфичному для Docker, описанному выше. Это касается исключительно **docker-compose.yml**.

Значения в файле `.env` записываются в следующих обозначениях:

```ini
VARIABLE_NAME=some value
OTHER_VARIABLE_NAME=some other value, like 5
```

Эти пары ключ-значение используются для замены переменных долларового обозначения в файле **docker-compose.yml**. Это своего рода этап предварительной обработки, и используется полученный временный файл. Это хороший способ избежать жесткого кодирования значений. Вы также можете использовать это, чтобы установить значения для переменных среды, заменив строку, но это не происходит автоматически.

Вот пример файла `docker-compose.yml`, основанный на значениях, предоставленных из файла `.env`:

```yaml
version: '3'

services:
  plex:
    image: linuxserver/plex
      environment:
        - env_var_name=${VARIABLE_NAME} # вот оно
```

{% hint style="info" %}
При работе с файлом **.env** вы можете легко отлаживать файлы **docker-compose.yml**. Просто введите `docker-compose config`. Таким образом, вы увидите, как выглядит содержимое файла **docker-compose.yml** после выполнения шага подстановки без запуска чего-либо еще.
{% endhint %}

> Вот подсказка, которую вы должны знать: переменные среды на вашем хосте могут переопределять значения в вашем файле **.env**. Подробнее [здесь](https://vsupalov.com/override-docker-compose-dot-env/).
