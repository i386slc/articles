# Использование веток Git с Setuptools

{% hint style="info" %}
Ссылка на оригинальную статью: [Using Git Branches With Setuptools](https://benhoff.net/using-git-branches-with-setuptools.html)

Опубликовано: 28 декабря 2017

Авторы: By [@Ben Hoff](https://benhoff.net/author/ben-hoff.html) in [\[ Random \]](https://benhoff.net/category/random.html)
{% endhint %}

Я хотел добавить ветку **git** в зависимости от моего проекта в файле `setup.py`. Должно быть легко, верно?

Несколько часов исследований спустя и пингование мейнтейнера проекта, чтобы позже добавить версию в его ветку…

И это на самом деле не так уж плохо, если вы знаете, как это сделать. Итак, давайте разберемся, как это сделать.

В методе установки `setup.py` вам нужно иметь два аргумента.

* install\_requires
* dependency\_links

В этом случае я пытался добавить в свой проект ветку [python-prompt-toolkit](https://github.com/jonathanslenders/python-prompt-toolkit) 2.0.0 (версия 1.0.15 в настоящее время находится в pypi).

Давайте сначала выберем простой, **install\_requires**.

```python
install_requires = ['prompt-toolkit>=2.0.0']
```

В настоящее время синтаксический анализ этого требования невозможен из-за того, что в pypi нет версии **prompt-toolkit** выше или равной `2.0.0`. Итак, давайте исправим это, указав ветку `2.0.0` в ссылках зависимостей.

```python
dependency_links = [
    'git+https://github.com/jonathanslenders/python-prompt-toolkit@2.0#egg=prompt-toolkit-2.0.0'
]
```

В том, как написана эта ссылка, есть несколько особенностей, которые плохо документированы, и поэтому о них стоит написать.

1. `git+https://github.com/jonathanslenders/python-prompt-toolkit` -> Стандартный задокументированный способ установки ссылок **git** с помощью **pip**. Здесь не на что смотреть, просто к вашему сведению.
2. `@2.0` указывает ветку, которую мы хотим использовать. Обратите внимание, что в данном случае это число, но это может быть любая ветка, которая вам нужна. То есть **dev** будет общим интересным именем ветки, которое можно использовать, указав `@dev`.
3. `#egg=prompt-toolkit-2.0.0` — самая важная часть, о которой стоит рассказать немного подробнее.

Нам нужно указать, какой пакет предоставляет эта ссылка зависимости. Мы делаем это с помощью синтаксиса `#egg=PACKAGE_NAME`. В этом случае эта ссылка зависимости предоставляет пакет **prompt-toolkit**, т. е. `#egg=prompt-toolkit`

Но самая важная часть этой части ссылки на зависимость, которая вообще не документирована, заключается в том, что вы _**должны**_ указать номер версии. Я сделал это здесь с `-2.0.0`. Номер версии, который вы предоставляете, может быть любой версией, но он должен быть там.

Так, например, если вы хотите указать зависимость от разрабатываемой версии **Vexbot**, ссылка зависимости может выглядеть так:

```python
dependency_links = ['git+https://github.com/benhoff/vexbot@dev#egg=vexbot-0']
```

Обратите внимание на `-0`, указывающий номер версии в конце ссылки на зависимость **vexbot**.

Вы можете указать любой номер версии, который вы хотите, чтобы помочь пользователю правильно указать, какая версия вам действительно нужна (как я сделал с ограничением **install\_requires** в **prompt-toolkit**).

Обратите внимание, что ссылки на зависимости полезны! Вы можете использовать их для:

* Уточнения частного репозитория **git** в качестве зависимости в `setup.py`.
* Уточнения версии исправления репозитория поверх пакета в **pypi**
* Уточнения пакета, который не опубликован в pypi, но находится на **Github**.

Надеюсь, это поможет!
