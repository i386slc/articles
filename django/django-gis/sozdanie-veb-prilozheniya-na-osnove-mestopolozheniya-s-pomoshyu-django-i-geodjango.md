# Создание веб-приложения на основе местоположения с помощью Django и GeoDjango

{% hint style="info" %}
Ссылка на оригинальную статью: [Make a Location-Based Web App With Django and GeoDjango](https://realpython.com/location-based-app-with-geodjango-tutorial/)

Опубликовано: ???

Автор: [Ahmed Bouchefra](https://realpython.com/location-based-app-with-geodjango-tutorial/#author)
{% endhint %}

## Оглавление

* Инструменты, которые вы будете использовать
* Предпосылки
  * Установка Python 3
  * Установка зависимостей GeoDjango (GEOS, GDAL и PROJ.4)
  * Настройка пространственной базы данных с помощью PostgreSQL и PostGIS
* Настройка вашего проекта
  * Создание виртуальной среды
  * Установка Джанго
  * Создание проекта Джанго
  * Настройка базы данных PostgreSQL
  * Добавление GeoDjango
* Создание приложения Django
  * Создание модели Джанго
  * Создание таблиц базы данных
  * Добавление суперпользователя
  * Регистрация модели в административном интерфейсе
  * Добавление исходных данных
  * Отображение ближайших магазинов
* Заключение

{% hint style="info" %}
К этому руководству есть связанный видеокурс, созданный командой **Real Python**. Посмотрите его вместе с письменным учебным пособием, чтобы углубить свое понимание: [Make a Location-Based Web App With Django and GeoDjango](https://realpython.com/courses/make-location-based-web-app-django-and-geodjango/)
{% endhint %}

В этом руководстве вы узнаете, как использовать **Django** и **GeoDjango** для создания веб-приложения на основе определения местоположения с нуля. Вы будете создавать простое приложение для магазинов поблизости, в котором перечислены магазины, ближайшие к местоположению пользователя.

_**К концу этого урока вы сможете**_:

* Использовать **Django** для создания простого веб-приложения с нуля.
* Использовать подфреймворк **GeoDjango** для реализации функций геолокации в вашем приложении Django.
* Использовать пространственную базу данных (**PostgreSQL** и **PostGIS**), чтобы получить преимущества от пространственных функций и легко внедрять веб-приложения с учетом местоположения.

{% hint style="info" %}
Пример исходного кода приложения. Полный исходный код приложения, которое вы будете создавать в этом руководстве, доступен в [репозитории realpython/materials на GitHub](https://github.com/realpython/materials/tree/master/nearbyshops).
{% endhint %}

## Инструменты, которые вы будете использовать

Вы будете использовать следующие инструменты для разработки веб-приложения для ближайших магазинов:

* Язык программирования Python
* Веб-фреймворк Django
* База данных PostgreSQL для сохранения данных
* Расширение PostGIS для поддержки пространственных функций в базе данных PostgreSQL.
* pip для установки зависимостей
* Модуль venv для управления виртуальной средой
* Docker для установки PostgreSQL и PostGIS

<figure><img src="../../.gitbook/assets/Untitled_Diagram_8.webp" alt=""><figcaption></figcaption></figure>

Прежде чем перейти к практическим шагам, давайте сначала представим фреймворки, которые вы будете использовать.

[Django](https://www.djangoproject.com/) — самая популярная среда Python для создания веб-приложений. Это позволяет разработчикам быстро создавать прототипы и укладываться в сроки своих проектов, предоставляя множество встроенных API и вспомогательных платформ, таких как GeoDjango.

[GeoDjango](https://docs.djangoproject.com/en/2.1/ref/contrib/gis/) — это встроенное приложение, которое входит в состав Django как вспомогательный модуль. На самом деле это полноценный фреймворк, который также можно использовать отдельно от Django. Он предоставляет набор инструментов для создания веб-приложений ГИС.

ГИС ([GIS](https://en.wikipedia.org/wiki/Geographic\_information\_system)) расшифровывается как Географическая информационная система. Это информационная система ([организованная система сбора, организации, хранения и передачи информации](https://en.wikipedia.org/wiki/Information\_system)), предназначенная для обработки и манипулирования данными, имеющими географические или пространственные характеристики.

**GeoDjango** также предоставляет привязки Python к популярным пространственным библиотекам, таким как [GEOS](https://trac.osgeo.org/geos/), [GDAL](https://www.gdal.org/) и [GeoIP](https://github.com/maxmind/geoip-api-c), которые можно использовать отдельно без Django в любом приложении Python или интерактивно в оболочке.

**GeoDjango** стремится предоставить географическую веб-инфраструктуру мирового класса. За прошедшие годы он был переработан с целью упростить работу с геопространственными данными, другими словами, данными, которые определяют географическое положение естественных или искусственных объектов на Земле и хранятся в виде координат и топологий.

**GeoDjango** очень хорошо интегрируется с Django ORM и предоставляет набор полей геометрии, определенных [Open Geospatial Consortium (OGS)](http://www.opengeospatial.org/), которые можно использовать для отображения различных типов геометрии в геопространственных базах данных:

* [GeometryField](https://docs.djangoproject.com/en/2.1/ref/contrib/gis/model-api/#geometryfield) — это базовый класс для всех геометрических полей в GeoDjango.
* [PointField](https://docs.djangoproject.com/en/2.1/ref/contrib/gis/model-api/#pointfield) используется для хранения объектов GEOS [Point](https://docs.djangoproject.com/en/2.1/ref/contrib/gis/geos/#django.contrib.gis.geos.Point).
* [PolygonField](https://docs.djangoproject.com/en/2.1/ref/contrib/gis/model-api/#polygonfield) используется для хранения объектов GEOS [Polygon](https://docs.djangoproject.com/en/2.1/ref/contrib/gis/geos/#polygon) и так далее.

**GeoDjango** — это очень мощная платформа для хранения и работы с географическими данными с использованием Django ORM. Он предоставляет простой в использовании API для определения расстояний между двумя точками на карте, площадями многоугольников, точками внутри многоугольника и т. д.

Чтобы иметь возможность работать с **GeoDjango**, вам понадобятся две вещи: пространственная база данных и геопространственные библиотеки. [Пространственная база данных](https://en.wikipedia.org/wiki/Spatial\_database) — это база данных, оптимизированная для хранения и запроса данных, представляющих объекты, определенные в геометрическом пространстве.

Чтобы в полной мере использовать все функции **GeoDjango**, вам необходимо установить следующие геопространственные библиотеки с открытым исходным кодом:

* **GEOS** расшифровывается как Geometry Engine с открытым исходным кодом. Это порт C++ JTS (Java Topology Suite), который реализует [простую функцию OCG для спецификации SQL](http://www.opengeospatial.org/standards/sfs).
* **GDAL** расшифровывается как библиотека абстракции геопространственных данных. Это библиотека с открытым исходным кодом для работы с растровыми и векторными [форматами геопространственных данных](https://en.wikipedia.org/wiki/GIS\_file\_formats).
* [PROJ.4](https://proj4.org/) предназначен для библиотеки картографических проекций. Это библиотека ГИС с открытым исходным кодом для простой работы с системами пространственной привязки и проекциями.
* **GeoIP** — это библиотека, которая помогает пользователям находить географическую информацию на основе IP-адреса.

В этом руководстве используется система **Ubuntu 18.04** для установки предварительных условий и **bash Unix** для запуска команд, но это не должно быть проблемой для вас, если вы используете любую другую систему, особенно системы на основе Unix, такие как macOS.

Для большинства инструкций по установке вы будете использовать менеджер пакетов [aptitude](https://help.ubuntu.com/lts/serverguide/aptitude.html.en), поэтому вам следует просто заменить его эквивалентным менеджером пакетов для вашей системы.

## Предпосылки

В этом разделе вы установите предварительные условия, необходимые для начальной загрузки вашего проекта, такие как [зависимости](https://realpython.com/courses/managing-python-dependencies/) Python 3 и GeoDjango (GEOS, GDAL и PROJ.4). Вы также будете использовать Docker для настройки базы данных PostgreSQL и PostGIS для вашего проекта.

### Установка Python 3

Есть большая вероятность, что в вашей системе уже установлен Python 3. Если нет, вы можете просто зайти на [официальный сайт](https://www.python.org/downloads/) и скачать бинарные файлы для вашей операционной системы.

В зависимости от вашей системы вы также можете установить Python 3 или обновить его до последней версии, если он уже установлен, с помощью официального диспетчера пакетов.

Если у вас возникли проблемы с установкой Python 3 или вам нужна дополнительная информация, вы можете обратиться к [Руководству по установке и настройке Python 3](https://realpython.com/installing-python), в котором представлены различные способы установки Python 3 в вашей системе.

Наконец, вы можете проверить, установлен ли у вас Python 3, выполнив следующую команду:

```bash
$ python3 --version
Python 3.6.5
```

### Установка зависимостей GeoDjango (GEOS, GDAL и PROJ.4)

GeoDjango требует пространственную базу данных и набор геопространственных библиотек с открытым исходным кодом:

* **GEOS** — это геометрический движок с открытым исходным кодом и порт C++ JTS (Java Topology Suite). Это требуется GeoDjango для выполнения геометрических операций.
* **PROJ.4** — это ГИС-библиотека с открытым исходным кодом для простой работы с системами пространственной привязки и проекциями. Вам это нужно, потому что вы будете использовать PostGIS в качестве пространственной базы данных.
* **GDAL** — это библиотека абстракции геопространственных данных с открытым исходным кодом для работы с растровыми и векторными форматами данных. Это необходимо для многих утилит, используемых GeoDjango.

Вы можете обратиться к документации для получения дополнительной информации о [пространственных базах данных и необходимых библиотеках](https://docs.djangoproject.com/en/2.1/ref/contrib/gis/install/geolibs/).

[GDAL 2.2](https://launchpad.net/ubuntu/bionic/+source/gdal) включен в Ubuntu 18.04, поэтому вы можете просто запустить следующую команду, чтобы установить его:

```bash
$ sudo aptitude install gdal-bin libgdal-dev
$ sudo aptitude install python3-gdal
```

{% hint style="info" %}
**python3-gdal** — это привязка Python 3 для **GDAL**.
{% endhint %}

Затем вы можете установить другие библиотеки, используя следующее:

```bash
$ sudo aptitude install binutils libproj-dev
```

{% hint style="info" %}
Поскольку вы используете бинарный пакет для **GEOS**, вам также необходимо [установить binutils](https://docs.djangoproject.com/en/2.1/ref/contrib/gis/install/#binutils).
{% endhint %}

Подробные инструкции по установке этих зависимостей в [macOS](https://docs.djangoproject.com/en/2.1/ref/contrib/gis/install/#macos) и [Windows](https://docs.djangoproject.com/en/2.1/ref/contrib/gis/install/#windows) см. в документации.

Для получения дополнительной информации о PROJ.4 вы можете обратиться к его официальной [документации](https://proj4.org/install.html).

### Настройка пространственной базы данных с помощью PostgreSQL и PostGIS

Вы будете использовать PostgreSQL, наиболее часто используемую базу данных с Django. Это не пространственная база данных, но благодаря PostGIS вы можете дополнить свою базу данных мощными геопространственными функциями.

[PostGIS](http://postgis.net/) — это пространственное расширение базы данных, которое необходимо установить в базу данных [PostgreSQL](https://www.postgresql.org/), что дает ему возможность хранить пространственные данные и работать с ними, а также выполнять пространственные операции. Он добавляет поддержку географических объектов, позволяющую выполнять запросы о местоположении в SQL.

Вы можете либо установить PostgreSQL в своей системе, создать базу данных, а затем добавить расширение PostGIS, либо, что еще лучше, использовать Docker для быстрого создания базы данных с использованием образа [kartoza postgis](https://hub.docker.com/r/kartoza/postgis/), который предоставляет контейнер с уже установленными PostgreSQL и PostGIS:

```bash
$ docker run --name=postgis -d \
    -e POSTGRES_USER=user001 \
    -e POSTGRES_PASS=123456789 \
    -e POSTGRES_DBNAME=gis \
    -p 5432:5432 \
    kartoza/postgis:9.6-2.4
```

После запуска команды у вас будет сервер PostgreSQL, прослушивающий порт **5432** с базой данных под названием **gis**. База данных использует имя пользователя **user001** и пароль **123456789**.

{% hint style="info" %}
В вашей системе должен быть установлен Docker. Для получения инструкций вы можете просто обратиться к официальной [документации](https://docs.docker.com/install/).
{% endhint %}

## Настройка вашего проекта

### Создание виртуальной среды

### Установка Джанго

### Создание проекта Джанго

### Настройка базы данных PostgreSQL

### Добавление GeoDjango

## Создание приложения Django

### Создание модели Джанго

### Создание таблиц базы данных

### Добавление суперпользователя

### Регистрация модели в административном интерфейсе

### Добавление исходных данных

### Отображение ближайших магазинов

## Заключение
